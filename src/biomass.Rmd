---
title: "biomass"
author: "Gabe Runte"
date: "6/30/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(janitor)
library(lubridate)
library(calecopal)
library(tidyverse)
library(dplyr)
```

```{r, message=FALSE}
seedlings = read_csv(here("data", "seedling_measurements.csv")) %>% 
  clean_names()

wet = read_csv(here("data", "ghecto_repotting_destruction.csv")) %>% 
  mutate(correction = wet_below_g/(wet_below_g - wet_tips_g))
dry = read_csv(here("data", "ghecto_repotting_dry_biomass.csv")) %>% 
  mutate(seedling_g = bag_with_seedling_g - just_bag_g)
```


```{r, message=FALSE}
dry_above = dry  %>% 
  filter(above_below == "A") %>%
  select(seedling_id, seedling_g) %>% 
  rename(dry_above_g = seedling_g)
dry_below = dry  %>% 
  filter(above_below == "B") %>%
  select(seedling_id, seedling_g) %>% 
  rename(dry_below_g = seedling_g)

seedling_treatments = seedlings %>% 
  select(seedling_id, seedling_sp, soil_type)

biomass = left_join(wet, dry_above) %>% 
  left_join(dry_below) %>% 
  mutate(dry_below_corrected = dry_below_g*correction) %>% 
  mutate(total_biomass_g = dry_below_corrected+dry_above_g) %>% 
  left_join(seedling_treatments) %>% 
  mutate(cohort = paste("spp",seedling_sp,"soil",soil_type,sep="" )) %>% 
  mutate(live_soil = 
           case_when(
             soil_type == "C" ~ "No",
             soil_type != "C" ~ "Yes",
           )) %>% 
mutate(above_below = dry_above_g/dry_below_corrected)
```
 
```{r}
ggplot(biomass[biomass$seedling_sp=="Q",], aes(cohort, total_biomass_g)) +
  geom_boxplot(aes(fill = cohort))
ggplot(biomass[biomass$seedling_sp=="P",], aes(cohort, total_biomass_g)) +
  geom_boxplot(aes(fill = cohort))

ggplot(biomass[biomass$seedling_sp=="Q",], aes(cohort, dry_above_g)) +
  geom_boxplot(aes(fill = cohort))
ggplot(biomass[biomass$seedling_sp=="P",], aes(cohort, dry_above_g)) +
  geom_boxplot(aes(fill = cohort))

ggplot(biomass[biomass$seedling_sp=="Q",], aes(cohort, dry_below_corrected)) +
  geom_boxplot(aes(fill = cohort))
ggplot(biomass[biomass$seedling_sp=="P",], aes(cohort, dry_below_corrected)) +
  geom_boxplot(aes(fill = cohort))

ggplot(biomass[biomass$seedling_sp=="Q",], aes(cohort, above_below)) +
  geom_boxplot(aes(fill = cohort))
ggplot(biomass[biomass$seedling_sp=="P",], aes(cohort, above_below)) +
  geom_boxplot(aes(fill = cohort))
```

```{r}
oak.b = biomass %>% 
  filter(seedling_sp == "Q")
bigcone.b = biomass %>% 
  filter(seedling_sp == "P")

lm1 = lm(above_below ~seedling_sp*live_soil, data= biomass)
summary(lm1)
AIC(lm1)

lm.oak = lm(above_below ~live_soil, data= oak.b)
summary(lm.oak)
AIC(lm.oak)

lm.oak = lm(above_below ~soil_type, data= oak.b)
summary(lm.oak)
AIC(lm.oak)


lm.bigcone = lm(above_below ~live_soil, data= bigcone.b)
summary(lm.bigcone)
AIC(lm.bigcone)

lm.bigcone = lm(above_below ~soil_type, data= bigcone.b)
summary(lm.bigcone)
AIC(lm.bigcone)

```

